# 第一章 可信计算概论(Trusted Computing)

## 一、基本概念

- 可信的定义：可信计算组织TCG(Trusted Computing Group)这样定义，一个实体如果它的行为总是<u>*以预期的方式*</u>，<u>*达到预期的目标*</u>，则这个实体就是可信的。

- 可信计算的定义：可信计算是指计算的同时进行安全防护，使计算结果总是与预期一样，计算全程可控可测，不被干扰。可以说，可信计算就是一种运算和防护并存的主动免疫的新计算模式。

- 可信计算<u>*以硬件安全为基础*</u>，以<u>*身份认证、完整性度量、信任传递*</u>为核心机制，从而保证计算平台的可信性和完整性。

- 可信计算具有<u>*度量、存储*</u>和<u>*报告*</u>三大基本功能。

## 二、可信计算的原理

- 可信计算的核心思想是<u>*硬件安全模块支持下*</u>的可信计算平台。

- 可信计算平台由由<u>*可信根、硬件平台、操作系统*</u>和<u>*应用系统*</u>组成，数据通过这条信任链能够保证其安全性。

- 可信计算机：

  <center><font color='red'><big>看图说话1</big></font></center>

![image-20201225104945676](C:\Users\pzype\Documents\GitHub\CDUT-CyberspaceSec-LearnDocs\可信计算\image-20201225104945676.png)

## 三、可信计算的发展阶段

1. 硬件可信阶段
2. 综合可信阶段
3. 深入发展阶段



# 第二章 可信平台模块(TPM, Trusted Computing Module)

可信计算平台模块可提供四大核心功能：

1. 完整性度量、存储和报告
2. 远程证明
3. 数据保护
4. 密钥管理

## 一、可信平台模块部件

三大部件：

1. **分离部件**
2. **通信接口**
3. **防篡改(攻击)封装**

![image-20201225111158741](C:\Users\pzype\Documents\GitHub\CDUT-CyberspaceSec-LearnDocs\可信计算\image-20201225111158741.png)

1）输入/输出(I/O)

负责处理通信总线上的数据流。

2）非易失性存储器(Non-volatile Storage)

用于存储EK(背书密钥, Endorsement Key)、SRK(存储根密钥, Storage Root Key)、所有者的授权数据和永久标志。PCR(平台配置寄存器, Platform Configuration Register)可以使用非易失性存储器或易失性存储器实现，在系统启动或下电时，PCR被复位。TCG指定PCR的最小数量为16，寄存器0~7保留给TPM使用，8~15供操作系统和应用程序使用。

3）AIK(身份证明密钥, Attestation Identity Key)

AIK必须是永久不变的，但是推荐将AIK作为密钥段存储在永久不变的外部存储设备中，而不是永久不变地存储在TPM内部的非易失性存储器中。

4）程序代码

程序代码包括用于测量平台设备的固件。

5）随机数发生器

TPM应该包含一个真随机数位发生器，用于产生随机数发生器的种子。

随机数发生器(RNG, Random Number Generate)用于密钥的生成，产生nonce和增强口令访问的熵。

6）SHA1加速器

SHA1信息摘要加速器用于计算数字签名，产生密钥段和其他常规应用。

7）RSA密钥产生器

TCG将RSA算法作为TPM中使用的标准算法。

8）RSA加速器

用于使用签名密钥进行数字签名，使用存储密钥进行加密和解密，使用EK进行解密。

  9）选择进入

控制I/O部件的访问规则。

10）执行引擎

执行引擎（CPU）运行程序代码，完成TMP初始化和测量的操作。

## 二、可信平台模块的技术支持

### 1.公钥加密算法

1976年，<u>*Diffie*</u>等人首次提出了公钥密码算法的设想。

<u>*Diffie-Hellman是第一个公钥算法*</u>，于美国的Difife和Hellman在1976年提出

RSA算法是由Rivest、Shamir和Adleman在1978年公开提出的一种公钥加密算法。

### 2.TPM密钥功能分类

TPM密钥按功能可以细分为7种类型。每一种类型都附加了一些约束条件以限制其应用。

1. **背书密钥(EK, Endorsement Key)**

   背书密钥(EK)是一个模长为2048bit的RSA公私钥对，EK是一个永远不会暴露在TPM外部的非迁移的解密密钥。对于一个TPM或者一个平台而言，<u>*EK是唯一的*</u>，它是*<u>平台信任的根基</u>*，<u>*代表着一个可信平台的真实身份*</u>，EK证书<u>*用于证明该平台是可信的*</u>。

2. **身份证明密钥(AIK)**

   EK唯一地标识了一个TPM，为了保证EK的安全，EK的公钥对在TPM内部进行硬件保护，但是同时TCG规定需要尽量避免使用EK，AIK就是为了代替EK来提供平台的证明，可以理解为*<u>EK的别名</u>*。

3. **储存密钥(Storage Key)**

   存储根密钥(SRK， Storage Root Key)是存储密钥(Storage Key)的一个特例，是拥有最高权限的存储密钥。

4. **签名密钥(Signing Key)**

   签名密钥是非对称密钥，用于*<u>对应用数据和信息签名</u>*。

5. **绑定密钥(Binding Key)**

   绑定密钥用于加密保护TPM外部的任意数据，通常用于<u>*加密小规模数据*</u>(如对称密钥)。

6. **继承密钥(Legacy Key)**

   继承密钥是在TPM外部生成的，该密钥<u>*既可用于签名也可用于加密*</u>，这些密钥用在一些需要在平台之间传递数据的场合。

7. **验证密钥(Authentication Key)**

   用于<u>*保护运用TPM完成的传输会话*</u>。



# 第三章 信任链构建技术

## 一、可信根

一个可信计算平台必须包括3个可信根(分别对应可信计算的3大基本功能)：

**可信度量根(RTM,  Root of Trust for Measurement)、可信存储根(RTS, Root of Trust for Storage)、可信报告根(RTR, Root of Trust for Report)**

1. **可信度量根(RTM)**

   RTM是一个用于生成固有的可依赖的<u>*完整性度量值的计算部件*</u>，它可以测量任何用户定义的平台配置。RTM通常被称为CRTM的一段代码。在平台启动后，主板上的启动代码CRTM是最先执行的，它是一段可信的代码，随着平台的启动，启动代码通过可信传递将信任扩展到整个平台。

2. **可信存储根(RTS)**

   RTS完成<u>*所有密钥的管理功能*</u>，包括密钥管理、密钥产生、加密和解密，RTS保护数据和密钥。

3. **可信报告根(RTR)**

   RTR<u>*允许受TPM保护的区域中的数据可以被验证通过的需求者获取*</u>，这些数据包括非易失性内存和平台配置寄存器(PCR)。

## 二、可信传递

可信传递就是可信根确定其下一级功能的可信度。如果下一级通过认证是可信的，则可信范围就从可信根扩大到下一级的功能；同样，第二级功能如果确定第三级功能可信，可信范围就扩大到第三级功能；这个过程不断重复，通过可信传递就能实现系统可信范围的延申。

<center><font color='red'><big>看图说话2</big></font></center>

![image-20210102224122565](C:\Users\pzype\Documents\GitHub\CDUT-CyberspaceSec-LearnDocs\可信计算\image-20210102224122565.png)

从<u>*硬件级的设备*</u>开始，每一级都会对下一级功能进行可信认证，经过BIOS、操作系统内核、操作系统服务然后进入用户应用程序和进程等。<u>*只要最开始进行可信传递的硬件设备是可信的*</u>，<u>*并且传递过程的认证等操作没有问题*</u>，可信范围就经过这一流程扩大到用户使用的程序，网络连接等，<u>*最终使整个系统都可信*</u>。

## 三、可信度量

可信度量就是对<u>*代码程序*</u>、及其<u>*相关配置信息*</u>进行完整性检验。

<u>*可信度量是可信计算的基础。*</u>

可信度量是通过HASH或者SHA-1进行的。

可信度量的完整性认证分为两个方面：

1. **完整性基准值的建立**

   信任链的建立过程可分为：

   ①获得可信任郑重各个阶段的认证基准值

   ②把这些基准值存储到安全存储区域中

   ③为了保证计算机系统启动时的完整性和可信性，在启动过程中如果某些关键文件或软件信息发生更改，需要重新计算可信认证种各个阶段的完整性基准值。

   这一过程发生在系统引导阶段，即从终端加电到操作系统装载。这一阶段BIOS、操作系统装载器以及操作系统顺序比较固定，是一个单一链式过程，这一过程的可信度量被称为静态可信度量。

2. **完整性认证，实现可信传递的过程**

   完整性认证过程是通过对实体认证计算结果和生成的完整性基准值相比较达到的。如果认证失败，说明被认证的实体对象被修改过，而且这种修改没有得到授权，因为得到授权的修改会重新计算完整性基准值。如果认证成功，说明被认证实体完整，没有被篡改，因此可以认为该实体可信，可以将信任安全传递到下一级。这一过程的可信度量称为动态可信度量。

## 四 、信任链构建分类

在终端PC上，通过可信认证进行可信传递包括两个过程：

1. 从终端加电至操作系统装载的静态可信认证(静态信任链)。静态信任链是指从平台加电启动开始构建，以CRTM为可信根，经过BIOS、BootLoader、操作系统、应用程序等将可信性传递到整个系统的信任链机制。所谓静态，是指平台一次运行对应于一个信任链，一个起点一个终点，平台运行中只能向下一级扩展信任链，无法重建、回溯。
2. 从操作系统至应用程序的动态可信认证(动态可信链)。 首先应用程序调用CPU的DRTM(动态度量根, Dynamic RTM)指令并指明要进行保护的内存空间地址。CPU禁止DMA访问该内存地址段、禁止中断和debug命令。将程序载入CPU缓存并锁定缓存防止其中程序代码被篡改。然后设置PCR[17~20]的值为-1，这些又被叫做动态，除因为其中用于构建动态可信链外，还因为它们的值是可以在平台运行时被反复重置的。将缓存发送到TPM进行度量并扩展完整性到PCR17。

<big>**两种方式的优缺点**</big>

**静态信任链：**

优点：能够确保恶意程序无法攻击信任链，无法通过重置、回溯手段篡改信任链。

缺点：一旦平台进入不可信状态，从信任链角度，平台以后所有的状态都是不可信的，因为信任的传递被中断了。并且即使通过杀毒、修复等手段清除了不可信因素，平台也无法回到一个可信状态。



只能保证加载时软件的完整性，无法保证运行时的完整性，无法抵御运行时的攻击

软件数量巨大并且不会具备

**动态信任链：**

优点：

<font color='red'>草，什么玩意，看不懂</font>

## 五、信任链的应用

<center><font color='red'><big>看图说话3</big></font></center>

![image-20210102231944688](C:\Users\pzype\Documents\GitHub\CDUT-CyberspaceSec-LearnDocs\可信计算\image-20210102231944688.png)

TCG制定的可信计算规范<u>*通过硬件实现的可信根*</u>来建立信任链，以<u>*TPM和BIOS启动模块为可信根*</u>，将<u>*CRTM(可信度量根核，Core Root of Trust for Measurement)作为起点*</u>。CRTM可以认为是引导BIOS的程序，是一段简单可控的代码模块，认为是绝对可信的。具体过程为：

①启动计算机，开始<u>*运行CRTM*</u>

②CRTM开始<u>*度量BIOS的完整性*</u>，并<u>*保存其度量基准值*</u>，随后<u>*把控制权交给*</u>BIOS

③BIOS随即初始化，并开始<u>*度量主引导区的完整性*</u>，保存度量基准值，装入主引导区，随后把控制权交给主引导区

④主引导区<u>*度量OS加载器的完整性*</u>，保存度量基准值，装入OS加载器，随机把控制权交给OS加载器

⑤OS Loader<u>*度量OS的完整性*</u>，保存度量基准值，装入OS，随即把控制权交给OS

⑥OS<u>*度量Application的完整性*</u>，保存度量基准值，装入Application，随即把控制权交给Application

⑦应用软件<u>*Application运行*</u>

如此以逐级度量，逐级信任的方式传递信任链，从根本上保证了计算机系统的安全



尽管这种信任链传递模型能保证一定的可信性，但是仍存在一些不足之处：

1. 信任链较长
2. 计算量大
3. 实现技术薄弱



# 第四章 可信软件栈

## 一、TSS体系结构

可信软件栈(TSS)为<u>*上层的可信计算应用*</u>提供访问TPM的接口。

<center><font color='red'><big>看图说话4</big></font></center>

![image-20210103112234756](C:\Users\pzype\Documents\GitHub\CDUT-CyberspaceSec-LearnDocs\可信计算\image-20210103112234756.png)



用户系统中存在的两种平台模式：用户模式和内核模式。

1. 内核模式

   内核模式是操作系统的设备驱动程序和核心组件驻留的地方。该区域的代码用于维护以及保护用户模式下运行的应用程序，通常需要某种类型的管理权限才能修改或更新。内核模式没有执行区分。

2. 用户模式

   用户模式是用户应用程序和服务执行的地方。这些应用程序和服务通常是根据用户的请求加载和执行的，但可能会作为启动序列的一部分被加载。操作系统提供了一个或多个保护区域，以便于不同的应用程序或服务之间执行相互保护。用户模式下主要有两种应用。

   ①用户应用程序根据用户请求或利益驱使选择执行。由于其代码由用户提供并初始化，并且可能由用户执行，因此它没有在平台上执行的其他代码具有可信性。

   ②系统服务通常在操作系统初始化的过程中作为启动脚本的一部分开始执行，或由服务器请求执行。系统服务为用户应用提供通用的可信服务。由于其代码在各自进程种执行，与用户应用分开并由操作系统激发执行，因此它被认为比用户应用可靠，并且可能与内核模式可执行文件一样居于偶可信性。在Windows操作系统中它被称为系统服务，在UNIX操作系统中它被称为daemon(守护进程)。



TSS体系分为3层，各个层次都定义了规范化的函数接口：

①TPM驱动设备（TDD, TPM Device Driver)，由制造商提供，嵌入能够理解TPM具体行为的代码，并在内核模式下载入和运行。因为用户模式的执行不能访问内核模式的执行，制造商也需要提供TCG设备驱动库，由TSS打开TPM设备驱动器。除TSS外，此驱动不允许任何程序与TPM设备有附加的连接。

②







## 二、TSS应用实例——远程证明

远程证明(Remote Attestation)是指在计算机网络中，一台计算机(挑战者)依据另一台配备有TPM的可信计算机(证明者)提供的证据对其匹配TPM平台的完整性做出承诺的一种活动。

远程证明是通过一个典型的<big><u>*“挑战-应答”*</u></big>协议实现的。

两种协议：TSS1.1中的Privacy CA(Certificate Authority)协议、TSS1.2中的直接匿名认证协议(DAA)



# 第五章 可信计算平台(TCP)

## 一、可信计算平台体系架构

分为三层：

1. 基础硬件层
2. 可信服务层
3. 安全应用层

![image-20210104135616744](C:\Users\pzype\Documents\GitHub\CDUT-CyberspaceSec-LearnDocs\可信计算\image-20210104135616744.png)

## 二、可信机制

- 可信机制，即<u>*保障可信计算平台安全可行的机制*</u>。

- 分为三种：<u>*可信度量机制、可信存储机制、可信报告机制*</u>和<u>*可信认证机制*</u>。

可信度量机制是平台<u>*完整性度量机制*</u>，该机制负责<u>*度量平台状态的完整性信息*</u>，并按照特定的方法和步骤进行比对和报告。



# 第七章 远程证明技术

## 一、技术基础

- 其中<u>*完整性度量*</u>和<u>*平台身份密钥引证*</u>是最重要的基础安全支撑功能。

- 完整性度量和完整性报告解决了<big><u>*“证明什么”*</u></big>的问题；TPM/TCM身份密钥引证解决了<big><u>*“如何证明”*</u></big>的问题。

- 远程证明过程分为3个阶段：<big><u>*完整性度量*</u></big>、<big><u>*完整性报告*</u></big>、<big><u>*完整性证明*</u></big>。



基于AIK的远程证明流程：

1. 可信计算平台向可信第三方发起AIK证书签名请求
2. 可信第三方对AIK证书进行签名并将证书发送给可信计算平台
3. 远程验证方(Verifier)向可信计算平台发送一个证明挑战随机数nonce
4. 可信计算平台加载AIK密钥，对PCR值进行签名，并发送到远程验证方(Verifier)
5. 远程验证方向可信第三方发起请求，查询可信计算平台的证明信息是否有效

## 二、Privacy CA方案

### 1.平台身份证书颁发

<center><font color='red'><big>看图说话5</big></font></center>

![image-20210103174448060](C:\Users\pzype\Documents\GitHub\CDUT-CyberspaceSec-LearnDocs\可信计算\image-20210103174448060.png)

①TPM所有者使用TPM安全芯片生成RSA签名密钥AIK，然后执行命令接口TPM_MakeIdentity<u>*将AIK公钥、EK证书、平台证书和一致性证书打包*</u>

②可信计算平台将这些数据作为AIK证书申请请求<u>*发送给可信第三方Privacy CA*</u>

③Privacy CA通过验证EK证书、平台证书等的有效性来<u>*验证AIK请求的有效性*</u>

④Privacy CA使用签名密钥<u>*对AIK证书进行签名*</u>，并<u>*使用EK的公钥加密AIK证书*</u>

⑤Privacy CA<u>*将AIK证书应答数据包返回*</u>给TPM，TPM所有者执行命令接口TPM_ActiveIdentity<u>*解密获得AIK证书*</u>

### 2.平台身份认证

<center><font color='red'><big>看图说话6</big></font></center>

![image-20210103185744601](C:\Users\pzype\Documents\GitHub\CDUT-CyberspaceSec-LearnDocs\可信计算\image-20210103185744601.png)

①平台A所有者向平台B<u>*发送证明请求*</u>

②平台B向平台A发出证明挑战<u>*随机数nonce*</u>，同时指明需要<u>*证明PCR*</u>

③平台A所有者<u>*加载AIK密钥*</u>，然后使用AIK私钥对需要证明的<u>*PCR值签名*</u>

④平台A将<u>*远程证明签名以及平台配置完整性日志*</u>发送给平台B的验证者

⑤平台B请求Privacy CA，查询<u>*平台A的TPM身份是否可信*</u>

⑥如果A的TPM身份可信，则平台B验证平台A的远程证明签名以及平台配置完整性日志<u>*是否有效*</u>

## 三、平台完整性证明

最主要的证明技术包括<u>*基于二进制*</u>的远程证明技术和<u>*基于属性*</u>的远程证明技术



# 第八章 可信网络连接(Trusted Network Connection)

## 一、NAC(网络接入控制，Network Access Control)技术框架

![image-20210103194811062](C:\Users\pzype\Documents\GitHub\CDUT-CyberspaceSec-LearnDocs\可信计算\image-20210103194811062.png)

- NAC由<u>*NAC客户端、NAC策略执行点、NAC策略决策点、隔离修复服务器*</u>组成
  - NAC客户端<u>*发起接入网络请求*</u>，并<u>*收集和提供客户端的身份和安全状态信息*</u>。
  - NAC策略决策服务器<u>*制定终端接入网络的安全策略*</u>，以及<u>*对接入终端进行用户信息和安全信息的认证*</u>。
  - NAC策略执行点为网络设备，<u>*执行由策略决策服务器给出的接入策略*</u>。
  - 不符合安全策略要求的终端将<u>*被送入隔离修复器进行隔离*</u>，并且隔离修复服务器对不满足安全策略要求的系统组件<u>*进行修复*</u>，直到它们符合网络安全策略才会被允许接入网络

## 二、C-NAC技术和NAP技术

C-NAC(网络准入控制, Network Access Control)，由思科公司开发

NAP(网络接入保护, Network Access Protect)，由微软公司开发

## 三、TNC架构

鉴于以上现有的网络接入技术的缺陷，TCG提出了可信网络连接架构(TNC架构)

<center><font color='red'><big>看图说话7</big></font></center>

![image-20210103190232906](C:\Users\pzype\Documents\GitHub\CDUT-CyberspaceSec-LearnDocs\可信计算\image-20210103190232906.png)

- TNC结构包含3个实体、3个层次和若干个接口。
- 3个实体：访问请求者(AR, Access Requestor)、策略执行点(PEP, Policy Enforcement Point)、策略决定点(PDP, Policy Decision Point)
- 3个层次：网络访问层、完整性评估层、完整性度量层

由于多个实体和层次的存在，为了实现实体之间、层次之间的互操作，TNC定义了一组接口规范。

### 1.实体

**AR**：发出AR<u>*访问请求*</u>，<u>*收集平台完整性信息*</u>，发送给PDP

**PDP**：根据安全策略对发出AR访问请求的终端<u>*进行认证和判定*</u>

**PEP**：负责根据PDP判定结果<u>*执行访问控制策略*</u>



**AR包含3个组件：**网络访问请求者(NAR, Network Access Requestor)、TNC客户端(TNCC, TNC Client)、完整性收集器(IMC, Integrity Measurement Collector)。

1. 网络请求者发出访问请求，<u>*申请建立网络连接*</u>，在一个AR中可以有多个NAR的存在；

2. TNC客户端负责<u>*调用完整性度量收集器收集各部分的完整性度量信息*</u>，同时<u>*度量并报告IMC自身的完整性信息*</u>；

3. 完整性度量收集器负责<u>*度量AR中各个组件的完整性*</u>，在同一个AR上可以有多个不同的IMC分别完成不同组件的完整性收集。



**PDP包含3个组件：**网络授权访问者(NAA, Network Access Authority)、可信网络连接服务器(TNCS, Trusted Network Connection Server)、完整性度量验证器(IMV, Integrity Measurement Verifier)。

1. 网络授权访问者根据上层的可信网络连接服务器的验证结果判定AR的完整性状态是否与PDP中的安全策略一致，从而决定AR的接入请求是否被允许；

2. 可信算个罗连接服务器负责与TNC客户端进行通信并且收集来自完整性度量验证器的决策，形成一个全局的网络访问决策传递给网络访问授权者；

3. 完整性度量验证器负责将完整性度量收集器传递过来的AR各个部件的完整性度量信息进行验证。

### 2.层次

**完整性度量层**：收集和处理原始的与具体接入策略无关的完整性度量数据

**完整性评估层**：根据访问策略对AR进行完整性评估

**网络访问层**：负责底层网络的连接，在网络访问层的访问请求者和访问授权者之间建立可靠的通信连接



**完整性度量层包含三个组件：**

1. AR负责收集完整性数据，PDP



### 3.操作接口



# 第九章 可信管理概述(Trust Management)

可信管理是当前分布式网络环境下的。。。。。。。。。。。

## 一、信任的定义

当实体A假定实体B严格按照A所期望的那样行动，那么A信任B。

## 二、信任的分类

信任可以分为身份信任(Identity Trust)和行为信任(Behavior Trust)。

行为信任分为直接信任(Direct Trust)和间接信任(Indirect Trust)。

间接信任又可称为推荐或者声誉(Reputation)。





题型分布：选择20、判断10、填空10、简答36、综合24



